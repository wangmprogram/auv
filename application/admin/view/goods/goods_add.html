{include file="public\head" title="商品列表"}
<link href="__STATIC__/admin/lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<body>
<div class="page-container">
	<form action="" method="post" class="form form-horizontal" id="form-goods-add" enctype="multipart/form-data">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="goods_name" name="goods_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">产品简介：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="goods_remark" name="goods_remark">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">产品货号：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="goods_sn" name="goods_sn">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<span class="select-box" style="width: 250px">
					<select name="p_id" id="p_id" class="select" type="parent_cat_id">
						{foreach $parentCate as $value}
						<option value="{$value.id}">{$value.name}</option>
						{/foreach}
					</select>
				</span>
				<span class="select-box" style="width: 250px">
					<select name="f_id" id="f_id" class="select" type="cat_id">
						{foreach $firstChildCate as $value}
						<option value="{$value.id}">{$value.name}</option>
						{/foreach}
					</select>
				</span>
				<span class="select-box" style="width: 250px">
					<select name="s_id" id="s_id" class="select">
						{foreach $secondChildCate as $value}
						<option value="{$value.id}">{$value.name}</option>
						{/foreach}
					</select>
				</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品品牌：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<span class="select-box" style="width: 250px">
					<select name="brand_id" id="brand" class="select">
						{foreach $brands as $value}
						<option value="{$value.id}">{$value.name}</option>
						{/foreach}
					</select>
				</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品展示价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" name="shop_price" id="shop_price" placeholder="" value="" class="input-text" style="width:90%">
				元</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>市场价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" name="market_price" id="market_price" placeholder="" value="" class="input-text" style="width:90%">
				元</div>
		</div>
		<!-- <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">成本价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" name="cost_price" id="cost_price" placeholder="" value="" class="input-text" style="width:90%">
				元</div>
		</div> -->
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">产品关键字：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" name="keywords" id="keywords" placeholder="多个关键字用英文逗号隔开，限10个关键字" value="" class="input-text">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品图片：</label>
			<div class="formControls col-xs-8 col-sm-9" id="preview">
				<button type="button" class="layui-btn" id="head_pic">
				        <i class="layui-icon">&#xe67c;</i>上传图片
				</button>
				<!-- <img src="" id="preview1"  height="40px"> -->
				<!-- <input type="hidden" name="logo" value="" id="logo">
				<input type="file" name="pic[]" multiple=""> -->
				<div id ="demo2"></div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">详细内容：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor" name="goods_content" type="text/plain" style="width:100%;height:400px;"></script> 
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
				<input class="btn btn-primary radius" type="submit" id="sub" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
			</div>
		</div>
	</form>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__STATIC__/admin/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__STATIC__/admin/static/layui/layui.js"></script>
<script type="text/javascript" src="__STATIC__/admin/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__STATIC__/admin/static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/static/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__STATIC__/admin/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="__STATIC__/admin/lib/webuploader/0.1.5/webuploader.min.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__STATIC__/admin/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
$(function(){
	$("#p_id").change(function(){
				getData($('#p_id'));
				getData($('#f_id'));
				getBrand($('#f_id'));
				// getBrand($('#f_id');
			});
	$("#f_id").change(function(){
				getData($('#f_id'));
				getBrand($('#f_id'));
			});
	function getData(ele){
		var cate_id = ele.val();
		$.ajax({
			type:"POST",
			url:"{:url('Goods/getCategory')}",
			data:{cate_id:cate_id},
			datType:"JSON",
			async:false,
			success:function(result){
				var _opt = '';
				$.each(result, function(k,val){
					_opt += '<option value="'+val.id+'">'+val.name+'</option>';
				})
				ele.parent().next().children().html(_opt);
			}
		})
	}
	function getBrand(ele){
		var cate_id = ele.val();
		var type = ele.attr("type");
		$.ajax({
			type:"POST",
			url:"{:url('Goods/getBrand')}",
			data:{id:cate_id,type:type},
			datType:"JSON",
			async:false,
			success:function(result){
				var _opt = '';
				$.each(result, function(k,val){
					_opt += '<option value="'+val.id+'">'+val.name+'</option>';
				})
				$("#brand").html(_opt);
			}
		})
	}

	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});

	layui.use('upload', function(){
		var upload = layui.upload;
		var uploadInst = upload.render({
			elem: '#head_pic',
			field:"file[]",
			multiple: true,
			auto:false,
			bindAction:"#sub",
			choose: function(obj){
     		 //预读本地文件示例，不支持ie8
		      obj.preview(function(index, file, result){
		        $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'"  style="height:90px;margin-right:10px">')
		      });
		    }
		})
	})
	$("#form-goods-add").validate({
		rules:{
			// name:{
			// 	required:true
			// },
			// role_id:{
			// 	required:true,
			// },
		},
		onkeyup:false,
		focusCleanup:true,
		success:"valid",
		submitHandler:function(form){
			$(form).ajaxSubmit({
				type: 'post',
				url: "{:url('Goods/goodsAdd')}",
				success: function(data){
					if(data.status==1){
						layer.msg(data.msg,{icon:1,time:1000},function(){
						var index = parent.layer.getFrameIndex(window.name);
			 			parent.$('.btn-refresh').click();
			 			window.parent.location.reload(); //刷新父页面
							parent.layer.close(index);
						});
					}else{
						layer.msg(data.msg,{icon:1,time:1500});
					}	
				},
                error: function(XmlHttpRequest, textStatus, errorThrown){
					layer.msg('error!',{icon:1,time:1000});
				}
			});
		
		}
	});
});

$(function(){
	var ue = UE.getEditor('editor');
});
</script>
</body>
</html>